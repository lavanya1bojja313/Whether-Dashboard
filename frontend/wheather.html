<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WeatherWear Pro - Professional Weather & Fashion Advisor</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <style>
        :root {
            --primary-color: #667eea;
            --secondary-color: #764ba2;
            --accent-color: #f093fb;
            --success-color: #10b981;
            --warning-color: #f59e0b;
            --error-color: #ef4444;
            --text-dark: #1f2937;
            --text-light: #ffffff;
            --text-muted: #6b7280;
            --card-bg: #ffffff;
            --bg-gradient-start: #667eea;
            --bg-gradient-end: #764ba2;
            --shadow: rgba(0, 0, 0, 0.1);
            --shadow-lg: rgba(0, 0, 0, 0.25);
            --border-radius: 20px;
            --transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .dark-mode {
            --primary-color: #4f46e5;
            --secondary-color: #7c3aed;
            --accent-color: #ec4899;
            --text-dark: #f9fafb;
            --text-light: #1f2937;
            --text-muted: #9ca3af;
            --card-bg: #1f2937;
            --bg-gradient-start: #1e1b4b;
            --bg-gradient-end: #312e81;
            --shadow: rgba(0, 0, 0, 0.3);
            --shadow-lg: rgba(0, 0, 0, 0.5);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, var(--bg-gradient-start), var(--bg-gradient-end));
            color: var(--text-dark);
            min-height: 100vh;
            transition: var(--transition);
            padding: 20px;
            position: relative;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at 20% 80%, rgba(120, 119, 198, 0.3) 0%, transparent 50%),
                        radial-gradient(circle at 80% 20%, rgba(255, 119, 198, 0.3) 0%, transparent 50%);
            z-index: -1;
        }

        .container { max-width: 1400px; margin: 0 auto; }

        .loading-spinner {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            backdrop-filter: blur(10px);
        }

        .loading-spinner.hidden { display: none; }

        .spinner {
            width: 60px;
            height: 60px;
            border: 4px solid var(--primary-color);
            border-top: 4px solid transparent;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 30px 0;
            margin-bottom: 30px;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .logo i {
            font-size: 3rem;
            background: linear-gradient(135deg, var(--primary-color), var(--accent-color));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }

        .logo h1 {
            font-size: 2.5rem;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            font-weight: 800;
            letter-spacing: -1px;
        }

        .header-controls {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .theme-toggle, .logout-btn {
            background: var(--card-bg);
            border: none;
            border-radius: 50%;
            width: 55px;
            height: 55px;
            cursor: pointer;
            box-shadow: 0 8px 32px var(--shadow);
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
            backdrop-filter: blur(20px);
        }

        .theme-toggle:hover, .logout-btn:hover {
            transform: scale(1.1) rotate(10deg);
            box-shadow: 0 12px 48px var(--shadow-lg);
        }

        .theme-toggle i, .logout-btn i {
            font-size: 1.5rem;
            color: var(--text-dark);
        }

        .auth-section {
            background: var(--card-bg);
            border-radius: var(--border-radius);
            padding: 50px;
            box-shadow: 0 20px 60px var(--shadow-lg);
            text-align: center;
            max-width: 600px;
            margin: 50px auto;
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .auth-section.hidden { display: none; }

        .auth-section h2 {
            margin-bottom: 20px;
            color: var(--primary-color);
            font-size: 2.5rem;
            font-weight: 700;
        }

        .auth-section p {
            margin-bottom: 40px;
            color: var(--text-muted);
            font-size: 1.2rem;
        }

        .google-signin-container {
            display: flex;
            justify-content: center;
            margin: 30px 0;
        }

        .guest-btn {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: var(--text-light);
            border: none;
            border-radius: 15px;
            padding: 18px 40px;
            font-size: 1.2rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            box-shadow: 0 8px 32px var(--shadow);
            margin-top: 20px;
        }

        .guest-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 48px var(--shadow-lg);
        }

        .app-section {
            display: none;
            animation: fadeIn 0.6s ease-out;
        }

        .app-section.active { display: block; }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .search-container {
            background: var(--card-bg);
            border-radius: var(--border-radius);
            padding: 40px;
            box-shadow: 0 20px 60px var(--shadow-lg);
            margin-bottom: 40px;
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .search-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }

        .search-header h2 {
            font-size: 2.2rem;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            font-weight: 700;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
            background: linear-gradient(135deg, var(--primary-color), var(--accent-color));
            padding: 15px 25px;
            border-radius: 50px;
            color: var(--text-light);
            box-shadow: 0 8px 32px var(--shadow);
        }

        .user-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            overflow: hidden;
            border: 3px solid rgba(255, 255, 255, 0.3);
        }

        .user-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .location-input-group {
            display: grid;
            grid-template-columns: 1fr auto auto;
            gap: 20px;
            margin-bottom: 30px;
        }

        .location-input {
            padding: 20px 25px;
            border: 2px solid transparent;
            border-radius: 15px;
            font-size: 1.2rem;
            outline: none;
            transition: var(--transition);
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            color: var(--text-dark);
        }

        .location-input:focus {
            border-color: var(--accent-color);
            box-shadow: 0 0 0 4px rgba(240, 147, 251, 0.2);
        }

        .search-button, .current-location-btn {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: var(--text-light);
            border: none;
            border-radius: 15px;
            padding: 0 30px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            box-shadow: 0 8px 32px var(--shadow);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .search-button:hover, .current-location-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 48px var(--shadow-lg);
        }

        .current-weather {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 40px;
            margin-top: 40px;
        }

        .weather-info {
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .location-name {
            font-size: 2.5rem;
            margin-bottom: 10px;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            font-weight: 700;
        }

        .date {
            color: var(--text-muted);
            margin-bottom: 30px;
            font-size: 1.2rem;
        }

        .temperature {
            font-size: 5rem;
            font-weight: 800;
            margin: 30px 0;
            background: linear-gradient(135deg, var(--primary-color), var(--accent-color));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            line-height: 1;
        }

        .weather-description {
            font-size: 1.8rem;
            margin-bottom: 30px;
            display: flex;
            align-items: center;
            gap: 20px;
            color: var(--text-dark);
        }

        .weather-icon { font-size: 4rem; }

        .weather-details {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 30px;
            margin-top: 30px;
        }

        .detail-item {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1), rgba(240, 147, 251, 0.1));
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .detail-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary-color);
            display: block;
            margin-bottom: 5px;
        }

        .detail-label {
            color: var(--text-muted);
            font-size: 1rem;
            font-weight: 500;
        }

        .weather-visual {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .weather-image {
            width: 100%;
            height: 300px;
            border-radius: var(--border-radius);
            box-shadow: 0 20px 60px var(--shadow-lg);
            object-fit: cover;
            margin-bottom: 20px;
        }

        .feels-like {
            font-size: 1.2rem;
            color: var(--text-muted);
            text-align: center;
        }

        .recommendations {
            background: var(--card-bg);
            border-radius: var(--border-radius);
            padding: 40px;
            box-shadow: 0 20px 60px var(--shadow-lg);
            margin: 40px 0;
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .section-title {
            font-size: 2.2rem;
            margin-bottom: 30px;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            display: flex;
            align-items: center;
            gap: 20px;
            font-weight: 700;
        }

        .clothing-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
        }

        .clothing-card {
            background: linear-gradient(135deg, var(--card-bg), rgba(255, 255, 255, 0.8));
            border-radius: var(--border-radius);
            padding: 30px;
            text-align: center;
            box-shadow: 0 15px 45px var(--shadow);
            transition: var(--transition);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .clothing-card:hover {
            transform: translateY(-10px) scale(1.02);
            box-shadow: 0 25px 70px var(--shadow-lg);
        }

        .clothing-image {
            width: 100%;
            height: 200px;
            border-radius: 15px;
            margin-bottom: 20px;
            object-fit: cover;
            box-shadow: 0 10px 30px var(--shadow);
        }

        .clothing-name {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 15px;
            color: var(--primary-color);
        }

        .clothing-desc {
            font-size: 1rem;
            color: var(--text-muted);
            line-height: 1.6;
        }

        .map-section {
            background: var(--card-bg);
            border-radius: var(--border-radius);
            padding: 40px;
            box-shadow: 0 20px 60px var(--shadow-lg);
            margin-top: 40px;
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        #map {
            height: 500px;
            border-radius: var(--border-radius);
            margin-top: 30px;
            box-shadow: 0 15px 45px var(--shadow);
        }

        .footer {
            text-align: center;
            padding: 40px 0;
            color: var(--text-muted);
            margin-top: 40px;
        }

        .permission-prompt {
            background: var(--card-bg);
            border-radius: var(--border-radius);
            padding: 40px;
            box-shadow: 0 20px 60px var(--shadow-lg);
            text-align: center;
            margin: 40px 0;
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .permission-prompt.hidden { display: none; }

        .permission-btn {
            background: linear-gradient(135deg, var(--success-color), #059669);
            color: var(--text-light);
            border: none;
            border-radius: 15px;
            padding: 18px 40px;
            font-size: 1.2rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            box-shadow: 0 8px 32px rgba(16, 185, 129, 0.3);
            margin-top: 20px;
        }

        .permission-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 48px rgba(16, 185, 129, 0.4);
        }

        .toast {
            position: fixed;
            top: 30px;
            right: 30px;
            background: var(--card-bg);
            padding: 20px 25px;
            border-radius: 15px;
            box-shadow: 0 15px 45px var(--shadow-lg);
            z-index: 10000;
            transform: translateX(400px);
            transition: var(--transition);
            border: 1px solid rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(20px);
        }

        .toast.show { transform: translateX(0); }
        .toast.error { border-left: 4px solid var(--error-color); }
        .toast.success { border-left: 4px solid var(--success-color); }

        @media (max-width: 1024px) {
            .current-weather { grid-template-columns: 1fr; }
            .location-input-group { grid-template-columns: 1fr; }
            .weather-details { grid-template-columns: repeat(2, 1fr); }
        }

        @media (max-width: 768px) {
            .container { padding: 0 15px; }
            .logo h1 { font-size: 2rem; }
            .auth-section, .search-container, .recommendations, .map-section { padding: 25px; }
            .clothing-grid { grid-template-columns: 1fr; }
            .weather-details { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <div class="loading-spinner hidden" id="loadingSpinner">
        <div class="spinner"></div>
    </div>

    <div class="container">
        <header>
            <div class="logo">
                <i class="fas fa-cloud-sun-rain"></i>
                <h1>WeatherWear Pro</h1>
            </div>
            <div class="header-controls">
                <button class="theme-toggle" id="themeToggle">
                    <i class="fas fa-moon"></i>
                </button>
                <button class="logout-btn hidden" id="logoutBtn">
                    <i class="fas fa-sign-out-alt"></i>
                </button>
            </div>
        </header>

        <section class="auth-section" id="authSection">
            <h2>Welcome to WeatherWear Pro</h2>
            <p>Get personalized weather forecasts and fashion recommendations from around the world</p>
            
            <div class="google-signin-container">
                <div id="g_id_onload"
                     data-client_id="YOUR_GOOGLE_CLIENT_ID"
                     data-context="signin"
                     data-ux_mode="popup"
                     data-callback="handleCredentialResponse"
                     data-auto_prompt="false">
                </div>
                
                <div class="g_id_signin"
                     data-type="standard"
                     data-shape="rectangular"
                     data-theme="outline"
                     data-text="signin_with"
                     data-size="large"
                     data-logo_alignment="left">
                </div>
            </div>
            
            <button class="guest-btn" id="guestAccess">
                <i class="fas fa-user-shield"></i> Continue as Guest
            </button>
        </section>

        <div class="permission-prompt hidden" id="permissionPrompt">
            <h3><i class="fas fa-map-marker-alt"></i> Enable Location Services</h3>
            <p>Allow WeatherWear Pro to access your location for accurate local weather forecasts and personalized recommendations.</p>
            <button class="permission-btn" id="grantPermission">
                <i class="fas fa-location-arrow"></i> Grant Location Access
            </button>
            <button class="guest-btn" id="skipLocation" style="background: var(--text-muted); margin-left: 15px;">
                Skip for Now
            </button>
        </div>

        <section class="app-section" id="appSection">
            <div class="search-container">
                <div class="search-header">
                    <h2>Global Weather Forecast</h2>
                    <div class="user-info" id="userInfo">
                        <div class="user-avatar" id="userAvatar">
                            <img src="" alt="User" id="userImage">
                        </div>
                        <div>
                            <div id="userName">Guest User</div>
                            <div style="font-size: 0.9rem; opacity: 0.8;">Weather Explorer</div>
                        </div>
                    </div>
                </div>
                
                <div class="location-input-group">
                    <input type="text" class="location-input" id="locationInput" placeholder="Search for any city worldwide...">
                    <button class="search-button" id="searchButton">
                        <i class="fas fa-search"></i> Search
                    </button>
                    <button class="current-location-btn" id="currentLocationBtn">
                        <i class="fas fa-crosshairs"></i> My Location
                    </button>
                </div>
                
                <div class="current-weather">
                    <div class="weather-info">
                        <h3 class="location-name" id="locationName">London, United Kingdom</h3>
                        <div class="date" id="currentDate"></div>
                        
                        <div class="temperature" id="temperature">--°</div>
                        
                        <div class="weather-description">
                            <i class="fas fa-cloud weather-icon" id="weatherIcon"></i>
                            <span id="weatherDescription">Loading...</span>
                        </div>
                        
                        <div class="weather-details">
                            <div class="detail-item">
                                <div class="detail-value" id="windSpeed">-- km/h</div>
                                <div class="detail-label">Wind Speed</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-value" id="humidity">--%</div>
                                <div class="detail-label">Humidity</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-value" id="pressure">-- hPa</div>
                                <div class="detail-label">Pressure</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="weather-visual">
                        <img class="weather-image" id="weatherImage" src="" alt="Weather Condition">
                        <div class="feels-like">
                            Feels like <span id="feelsLike">--°</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="recommendations">
                <h3 class="section-title">
                    <i class="fas fa-tshirt"></i> Smart Clothing Recommendations
                </h3>
                
                <div class="clothing-grid" id="clothingGrid">
                </div>
            </div>
            
            <div class="map-section">
                <h3 class="section-title">
                    <i class="fas fa-globe-americas"></i> Interactive World Map
                </h3>
                <p>Click anywhere on the map to explore weather conditions worldwide</p>
                <div id="map"></div>
            </div>
        </section>
        
        <div class="footer">
            <p>© 2024 WeatherWear Pro. All rights reserved.</p>
            <p style="margin-top: 10px; font-size: 0.9rem;">Powered by OpenWeatherMap API & Real-time Global Data</p>
        </div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        // ⚠️ REPLACE WITH YOUR ACTUAL API KEYS ⚠️
        const CONFIG = {
            WEATHER_API_KEY: 'bd5e378503939ddaee76f12ad7a97608', // Replace with your OpenWeatherMap API key
            GOOGLE_CLIENT_ID: 'YOUR_GOOGLE_CLIENT_ID', // Replace with your Google Client ID
            DEFAULT_LOCATION: { lat: 51.5074, lon: -0.1278, name: 'London, United Kingdom' }
        };

        let map, currentMarker, currentUser = null, currentLocation = null;

        const elements = {
            loadingSpinner: document.getElementById('loadingSpinner'),
            themeToggle: document.getElementById('themeToggle'),
            logoutBtn: document.getElementById('logoutBtn'),
            authSection: document.getElementById('authSection'),
            appSection: document.getElementById('appSection'),
            guestAccess: document.getElementById('guestAccess'),
            permissionPrompt: document.getElementById('permissionPrompt'),
            grantPermission: document.getElementById('grantPermission'),
            skipLocation: document.getElementById('skipLocation'),
            locationInput: document.getElementById('locationInput'),
            searchButton: document.getElementById('searchButton'),
            currentLocationBtn: document.getElementById('currentLocationBtn'),
            userImage: document.getElementById('userImage'),
            userName: document.getElementById('userName'),
            locationName: document.getElementById('locationName'),
            currentDate: document.getElementById('currentDate'),
            temperature: document.getElementById('temperature'),
            weatherIcon: document.getElementById('weatherIcon'),
            weatherDescription: document.getElementById('weatherDescription'),
            windSpeed: document.getElementById('windSpeed'),
            humidity: document.getElementById('humidity'),
            pressure: document.getElementById('pressure'),
            weatherImage: document.getElementById('weatherImage'),
            feelsLike: document.getElementById('feelsLike'),
            clothingGrid: document.getElementById('clothingGrid')
        };

        function showLoading() { elements.loadingSpinner.classList.remove('hidden'); }
        function hideLoading() { elements.loadingSpinner.classList.add('hidden'); }

        function showToast(message, type = 'success') {
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.innerHTML = `
                <div style="display: flex; align-items: center; gap: 10px;">
                    <i class="fas fa-${type === 'error' ? 'exclamation-circle' : 'check-circle'}"></i>
                    <span>${message}</span>
                </div>
            `;
            document.body.appendChild(toast);
            
            setTimeout(() => toast.classList.add('show'), 100);
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => document.body.removeChild(toast), 300);
            }, 3000);
        }

        elements.themeToggle.addEventListener('click', () => {
            document.body.classList.toggle('dark-mode');
            const icon = elements.themeToggle.querySelector('i');
            
            if (document.body.classList.contains('dark-mode')) {
                icon.className = 'fas fa-sun';
                localStorage.setItem('theme', 'dark');
            } else {
                icon.className = 'fas fa-moon';
                localStorage.setItem('theme', 'light');
            }
        });

        function loadSavedTheme() {
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme === 'dark') {
                document.body.classList.add('dark-mode');
                elements.themeToggle.querySelector('i').className = 'fas fa-sun';
            }
        }

        function handleCredentialResponse(response) {
            showLoading();
            
            try {
                const payload = JSON.parse(atob(response.credential.split('.')[1]));
                
                currentUser = {
                    id: payload.sub,
                    name: payload.name,
                    email: payload.email,
                    picture: payload.picture
                };
                
                elements.userName.textContent = currentUser.name;
                elements.userImage.src = currentUser.picture;
                elements.userImage.alt = currentUser.name;
                
                elements.authSection.classList.add('hidden');
                elements.logoutBtn.classList.remove('hidden');
                elements.appSection.classList.add('active');
                
                showToast(`Welcome back, ${currentUser.name}!`);
                initializeApp();
            } catch (error) {
                console.error('Authentication error:', error);
                showToast('Authentication failed. Please try again.', 'error');
                hideLoading();
            }
        }

        elements.guestAccess.addEventListener('click', () => {
            showLoading();
            
            currentUser = {
                name: 'Guest User',
                email: 'guest@weatherwear.com',
                picture: 'https://ui-avatars.com/api/?name=Guest+User&background=667eea&color=ffffff&size=150'
            };
            
            elements.userName.textContent = currentUser.name;
            elements.userImage.src = currentUser.picture;
            
            elements.authSection.classList.add('hidden');
            elements.appSection.classList.add('active');
            
            showToast('Welcome, Guest User!');
            initializeApp();
        });

        elements.logoutBtn.addEventListener('click', () => {
            if (currentUser && currentUser.email !== 'guest@weatherwear.com') {
                google.accounts.id.disableAutoSelect();
            }
            
            currentUser = null;
            elements.authSection.classList.remove('hidden');
            elements.appSection.classList.remove('active');
            elements.logoutBtn.classList.add('hidden');
            
            showToast('Logged out successfully');
        });

        function initializeApp() {
            setCurrentDate();
            initMap();
            
            setTimeout(() => {
                elements.permissionPrompt.classList.remove('hidden');
            }, 1000);
            
            getWeatherData(CONFIG.DEFAULT_LOCATION.lat, CONFIG.DEFAULT_LOCATION.lon);
            hideLoading();
        }

        function setCurrentDate() {
            const now = new Date();
            const options = { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            };
            elements.currentDate.textContent = now.toLocaleDateString('en-US', options);
        }

        elements.grantPermission.addEventListener('click', () => {
            if (navigator.geolocation) {
                showLoading();
                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        const { latitude, longitude } = position.coords;
                        currentLocation = { lat: latitude, lon: longitude };
                        
                        elements.permissionPrompt.classList.add('hidden');
                        
                        updateMapLocation(latitude, longitude);
                        getWeatherData(latitude, longitude);
                        
                        showToast('Location access granted!');
                        hideLoading();
                    },
                    (error) => {
                        console.error('Geolocation error:', error);
                        showToast('Unable to access location. Using default location.', 'error');
                        elements.permissionPrompt.classList.add('hidden');
                        hideLoading();
                    },
                    { timeout: 10000, enableHighAccuracy: true }
                );
            } else {
                showToast('Geolocation not supported by your browser', 'error');
                elements.permissionPrompt.classList.add('hidden');
            }
        });

        elements.skipLocation.addEventListener('click', () => {
            elements.permissionPrompt.classList.add('hidden');
        });

        elements.currentLocationBtn.addEventListener('click', () => {
            if (currentLocation) {
                updateMapLocation(currentLocation.lat, currentLocation.lon);
                getWeatherData(currentLocation.lat, currentLocation.lon);
            } else {
                elements.permissionPrompt.classList.remove('hidden');
            }
        });

        elements.searchButton.addEventListener('click', performSearch);
        elements.locationInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') performSearch();
        });

        async function performSearch() {
            const query = elements.locationInput.value.trim();
            if (!query) return;

            showLoading();
            
            try {
                const geocodeUrl = `https://api.openweathermap.org/geo/1.0/direct?q=${encodeURIComponent(query)}&limit=1&appid=${CONFIG.WEATHER_API_KEY}`;
                const geocodeResponse = await fetch(geocodeUrl);
                const geocodeData = await geocodeResponse.json();
                
                if (geocodeData.length > 0) {
                    const location = geocodeData[0];
                    updateMapLocation(location.lat, location.lon);
                    getWeatherData(location.lat, location.lon);
                    
                    elements.locationInput.value = '';
                } else {
                    showToast('Location not found. Please try a different search term.', 'error');
                }
            } catch (error) {
                console.error('Geocoding error:', error);
                showToast('Error searching for location', 'error');
            }
            
            hideLoading();
        }

        async function getWeatherData(lat, lon) {
            try {
                const weatherUrl = `https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lon}&appid=${CONFIG.WEATHER_API_KEY}&units=metric`;
                const response = await fetch(weatherUrl);
                
                if (!response.ok) {
                    throw new Error(`Weather API error: ${response.status}`);
                }
                
                const data = await response.json();
                updateWeatherDisplay(data);
                updateClothingRecommendations(data);
                
            } catch (error) {
                console.error('Weather API error:', error);
                showToast('Error fetching weather data. Please check your API key.', 'error');
            }
        }

        function updateWeatherDisplay(data) {
            const countryNames = new Intl.DisplayNames(['en'], { type: 'region' });
            const countryName = countryNames.of(data.sys.country) || data.sys.country;
            elements.locationName.textContent = `${data.name}, ${countryName}`;
            
            elements.temperature.textContent = `${Math.round(data.main.temp)}°C`;
            elements.feelsLike.textContent = `${Math.round(data.main.feels_like)}°C`;
            
            const weather = data.weather[0];
            elements.weatherDescription.textContent = weather.description.charAt(0).toUpperCase() + weather.description.slice(1);
            
            const iconMap = {
                '01d': 'fa-sun', '01n': 'fa-moon',
                '02d': 'fa-cloud-sun', '02n': 'fa-cloud-moon',
                '03d': 'fa-cloud', '03n': 'fa-cloud',
                '04d': 'fa-cloud', '04n': 'fa-cloud',
                '09d': 'fa-cloud-rain', '09n': 'fa-cloud-rain',
                '10d': 'fa-cloud-sun-rain', '10n': 'fa-cloud-moon-rain',
                '11d': 'fa-bolt', '11n': 'fa-bolt',
                '13d': 'fa-snowflake', '13n': 'fa-snowflake',
                '50d': 'fa-smog', '50n': 'fa-smog'
            };
            
            elements.weatherIcon.className = `fas ${iconMap[weather.icon] || 'fa-cloud'} weather-icon`;
            
            elements.windSpeed.textContent = `${Math.round(data.wind.speed * 3.6)} km/h`;
            elements.humidity.textContent = `${data.main.humidity}%`;
            elements.pressure.textContent = `${data.main.pressure} hPa`;
            
            updateWeatherImage(weather.main.toLowerCase(), weather.icon.includes('n'));
        }

        function updateWeatherImage(condition, isNight) {
            const imageMap = {
                clear: isNight ? 
                    'https://images.unsplash.com/photo-1506905925346-21bda4d32df4?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80' :
                    'https://images.unsplash.com/photo-1506260408121-e353d10b87c7?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80',
                clouds: 'https://images.unsplash.com/photo-1534088568595-a066f410bcda?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80',
                rain: 'https://images.unsplash.com/photo-1515694346937-94d85e41e6f0?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80',
                drizzle: 'https://images.unsplash.com/photo-1515694346937-94d85e41e6f0?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80',
                thunderstorm: 'https://images.unsplash.com/photo-1605727216801-e27ce1d0cc28?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80',
                snow: 'https://images.unsplash.com/photo-1578662996442-48f60103fc96?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80',
                mist: 'https://images.unsplash.com/photo-1487621167305-5d248087c724?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80',
                fog: 'https://images.unsplash.com/photo-1487621167305-5d248087c724?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80'
            };
            
            const imageUrl = imageMap[condition] || imageMap.clear;
            elements.weatherImage.src = imageUrl;
            elements.weatherImage.alt = `${condition} weather condition`;
        }

        function updateClothingRecommendations(weatherData) {
            const temp = weatherData.main.temp;
            const condition = weatherData.weather[0].main.toLowerCase();
            const windSpeed = weatherData.wind.speed * 3.6;
            
            let recommendations = [];
            
            if (temp <= 0) {
                recommendations = [
                    { name: 'Heavy Winter Coat', desc: 'Insulated coat for freezing temperatures', image: 'https://images.unsplash.com/photo-1544966503-7cc5ac882d5b?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&q=80' },
                    { name: 'Thermal Underwear', desc: 'Base layer to retain body heat', image: 'https://images.unsplash.com/photo-1441986300917-64674bd600d8?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&q=80' },
                    { name: 'Warm Winter Boots', desc: 'Insulated and waterproof footwear', image: 'https://images.unsplash.com/photo-1608256246200-53e635b5b65f?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&q=80' },
                    { name: 'Winter Accessories', desc: 'Hat, gloves, and scarf set', image: 'https://images.unsplash.com/photo-1578662996442-48f60103fc96?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&q=80' }
                ];
            } else if (temp <= 10) {
                recommendations = [
                    { name: 'Warm Jacket', desc: 'Insulated jacket for cold weather', image: 'https://images.unsplash.com/photo-1591047139829-d91aecb6caea?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&q=80' },
                    { name: 'Long Pants', desc: 'Warm trousers or jeans', image: 'https://images.unsplash.com/photo-1542272604-787c3835535d?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&q=80' },
                    { name: 'Closed-toe Shoes', desc: 'Sturdy footwear for cool weather', image: 'https://images.unsplash.com/photo-1543163521-1bf539c55dd2?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&q=80' },
                    { name: 'Light Scarf', desc: 'Additional warmth around neck', image: 'https://images.unsplash.com/photo-1578662996442-48f60103fc96?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&q=80' }
                ];
            } else if (temp <= 20) {
                recommendations = [
                    { name: 'Light Sweater', desc: 'Comfortable layering option', image: 'https://images.unsplash.com/photo-1434389677669-e08b4cac3105?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&q=80' },
                    { name: 'Long Sleeve Shirt', desc: 'Perfect for mild temperatures', image: 'https://images.unsplash.com/photo-1529374255404-311a2a4f1fd9?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&q=80' },
                    { name: 'Comfortable Jeans', desc: 'Classic everyday wear', image: 'https://images.unsplash.com/photo-1542272604-787c3835535d?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&q=80' },
                    { name: 'Sneakers', desc: 'Comfortable walking shoes', image: 'https://images.unsplash.com/photo-1549298916-b41d501d3772?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&q=80' }
                ];
            } else if (temp <= 30) {
                recommendations = [
                    { name: 'Light T-Shirt', desc: 'Breathable cotton or moisture-wicking', image: 'https://images.unsplash.com/photo-1521572163474-6864f9cf17ab?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&q=80' },
                    { name: 'Shorts or Light Pants', desc: 'Comfortable for warm weather', image: 'https://images.unsplash.com/photo-1594633312681-425c7b97ccd1?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&q=80' },
                    { name: 'Light Footwear', desc: 'Breathable shoes or sandals', image: 'https://images.unsplash.com/photo-1549298916-b41d501d3772?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&q=80' },
                    { name: 'Sun Hat', desc: 'Protection from UV rays', image: 'https://images.unsplash.com/photo-1521369909029-2afed882baee?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&q=80' }
                ];
            } else {
                recommendations = [
                    { name: 'UV Protection Shirt', desc: 'Lightweight, UV-blocking fabric', image: 'https://images.unsplash.com/photo-1586790170083-2f9ceadc732d?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&q=80' },
                    { name: 'Light Shorts', desc: 'Maximum breathability', image: 'https://images.unsplash.com/photo-1594633312681-425c7b97ccd1?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&q=80' },
                    { name: 'Sandals', desc: 'Cool and comfortable', image: 'https://images.unsplash.com/photo-1603487742131-4160ec999306?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&q=80' },
                    { name: 'Sunglasses & Hat', desc: 'Essential sun protection', image: 'https://images.unsplash.com/photo-1577803645773-f96470509666?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&q=80' }
                ];
            }
            
            if (condition.includes('rain') || condition.includes('drizzle')) {
                recommendations.push({ name: 'Waterproof Jacket', desc: 'Stay dry in wet conditions', image: 'https://images.unsplash.com/photo-1544966503-7cc5ac882d5b?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&q=80' });
                recommendations.push({ name: 'Umbrella', desc: 'Portable rain protection', image: 'https://images.unsplash.com/photo-1541823709867-1b206113eafd?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&q=80' });
            }
            
            if (windSpeed > 25) {
                recommendations.push({ name: 'Windbreaker', desc: 'Protection from strong winds', image: 'https://images.unsplash.com/photo-1544966503-7cc5ac882d5b?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&q=80' });
            }
            
            displayClothingRecommendations(recommendations.slice(0, 6));
        }

        function displayClothingRecommendations(recommendations) {
            elements.clothingGrid.innerHTML = '';
            
            recommendations.forEach(item => {
                const card = document.createElement('div');
                card.className = 'clothing-card';
                card.innerHTML = `
                    <img class="clothing-image" src="${item.image}" alt="${item.name}" loading="lazy">
                    <h4 class="clothing-name">${item.name}</h4>
                    <p class="clothing-desc">${item.desc}</p>
                `;
                elements.clothingGrid.appendChild(card);
            });
        }

        function initMap() {
            const defaultLocation = CONFIG.DEFAULT_LOCATION;
            map = L.map('map').setView([defaultLocation.lat, defaultLocation.lon], 10);
            
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
                maxZoom: 18
            }).addTo(map);
            
            currentMarker = L.marker([defaultLocation.lat, defaultLocation.lon])
                .addTo(map)
                .bindPopup(defaultLocation.name)
                .openPopup();
            
            map.on('click', function(e) {
                const { lat, lng } = e.latlng;
                updateMapLocation(lat, lng);
                getWeatherData(lat, lng);
            });
        }

        function updateMapLocation(lat, lon) {
            if (currentMarker) {
                map.removeLayer(currentMarker);
            }
            
            map.setView([lat, lon], 10);
            currentMarker = L.marker([lat, lon])
                .addTo(map)
                .bindPopup('Selected Location')
                .openPopup();
        }

        document.addEventListener('DOMContentLoaded', () => {
            loadSavedTheme();
            setCurrentDate();
            setInterval(setCurrentDate, 60000);
        });

        window.addEventListener('error', (e) => {
            console.error('Application error:', e.error);
            showToast('An error occurred. Please refresh the page.', 'error');
        });
    </script>
</body>
</html>